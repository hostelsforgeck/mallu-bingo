<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bingo Game</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <style>
       /* Scoped Styles for Modal Components */
       :root {
            --bg-color: #222;
            --text-color: #333;
            --notebook-bg: #cc4b48;
            --inner-bg: #fbfae8;
            --border-color: #111;
            --highlight-color: coral;
            --shadow-color-1: rgba(208, 91, 88, 0.4);
            --shadow-color-2: rgba(244, 68, 46, 0.5);
            --shadow-color-3: #ff2a3199;
            --highlight-bg: rgba(239, 184, 186, 0.3);
            --music-color: #e4572e;
        }

        /* Base Styles */
        body {
            background: var(--bg-color);
            font-family: "Gochi Hand", sans-serif;
            color: var(--text-color);
        }

        .modal-dialog {
            max-width: 600px;
            min-width: 650px;
            margin: 2em auto;
        }

        .modal-title {
            font-family: "Lobster", cursive;
            font-size: 48px;
            color: var(--inner-bg);
            text-shadow: 2px 1px 0 var(--border-color), 5px 4px 0 var(--highlight-color);
            margin: 0;
            width: 100%;
            text-align: left;
        }

        .modal-content {
            background: var(--notebook-bg);
            border-radius: 16px;
            padding: 2px 4px 2.5px;
            border: none;
        }

        .modal-body {
            background: linear-gradient(90deg, var(--inner-bg) 15px, transparent 1%) center,
                linear-gradient(var(--inner-bg) 15px, transparent 1%) center,
                #794949;
            background-size: 16px 16px;
            border-radius: 16px;
            padding: 30px 20px;
            min-height: 660px;
            display: flex;
            flex-direction: column;
        }

        .modal-header {
            border: none;
            background: transparent;
            padding: 20px;
        }

        .game-settings-row {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
            padding: 15px 20px;
            background: var(--inner-bg);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            box-shadow: 3px 3px 0 0 var(--shadow-color-1);
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }

        .settings-label {
            font-family: "Rock Salt", cursive;
            font-size: 18px;
            flex: 1;
        }

        .settings-control .form-select {
            font-family: "Special Elite", cursive;
            background: var(--inner-bg);
            /* Changed to music color */
            border: 2px solid var(--border-color);
            width: 150px;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 8px center;
            background-size: 16px;
            padding-right: 32px;
        }

        .form-select:focus{
            box-shadow: 3px 3px 0 0 var(--shadow-color-1);

        }

        

        .form-check-input {
            width: 24px;
            height: 24px;
            background: var(--inner-bg);
            border: 2px solid var(--border-color);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }
        .form-check-input:focus{
            box-shadow: 3px 3px 0 0 var(--shadow-color-1);

        }

        .form-check-input:checked {
            background-color: var(--music-color);
            border-color: var(--border-color);
            color: var(--inner-bg);
            /* Ensure tick mark remains visible */
        }

        .form-check-input:checked::after {
            content: "\2713";
            /* Use Unicode for tick mark */
            font-family: "Rock Salt", cursive;
            position: absolute;
            color: var(--inner-bg);
            font-size: 16px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .bingo-board {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            padding: 20px;
            margin: 20px auto;
            background: var(--inner-bg);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            max-width: 400px;
            width: 100%;
        }

        .bingo-cell,
        .bingo-cell input[type="number"] {
            font-family: "Special Elite", cursive;
            font-size: 18px;
            padding: 15px;
            text-align: center;
            background: var(--inner-bg);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            width: 100%;
            height: 60px;
            box-sizing: border-box;
        }

        .bingo-cell input[type="number"] {
            -moz-appearance: textfield;
        }

        .bingo-cell input[type="number"]::-webkit-outer-spin-button,
        .bingo-cell input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .btn-secondary {
            font-family: "Rock Salt", cursive;
            font-size: 16px;
            padding: 10px 25px;
            margin: 0 10px;
            background: var(--inner-bg);
            color: var(--text-color);
            border: 2px solid var(--border-color);
            box-shadow: 3px 3px 0 0 var(--shadow-color-1);
            transition: all 0.3s ease;
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 4px 4px 0 0 var(--shadow-color-2);
        }

        .btn-primary {
            font-family: "Lobster", cursive;
            font-size: 24px;
            padding: 15px 40px;
            background: var(--notebook-bg);
            color: var(--inner-bg);
            border: none;
            border-radius: 25px;
            box-shadow: 3px 3px 0 0 var(--shadow-color-1);
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            background: var(--notebook-bg);
            transform: translateY(-2px);
            box-shadow: 4px 4px 0 0 var(--shadow-color-2);
        }

        .alert {
            font-family: "Rock Salt", cursive;
            font-size: 14px;
            margin: 20px 0;
            background: var(--highlight-bg);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            display: none;
        }

        .modal-footer {
            border: none;
            background: transparent;
            padding: 20px;
            justify-content: center;
        }

        .modal-footer .btn-primary {
            font-family: "Lobster", cursive;
            font-size: 32px;
            padding: 15px 50px;
            background: var(--inner-bg);
            color: var(--music-color);
            border: 3px solid var(--border-color);
            border-radius: 25px;
            transition: all 0.3s ease;
            position: relative;
            transform-style: preserve-3d;
            width: auto;
            min-width: 150px;
            max-width: 300px;
        }

        .modal-footer .btn-primary:hover {
            background: var(--notebook-bg);
            transform: translateY(-4px) translateX(-2px);
            box-shadow: 7px 7px 0 0 var(--shadow-color-1),
                10px 10px 0 0 var(--shadow-color-2);
            color: var(--inner-bg);
        }

        .modal-footer .btn-primary:active {
            transform: translateY(2px) translateX(1px);
            box-shadow: 3px 3px 0 0 var(--shadow-color-1),
                5px 5px 0 0 var(--shadow-color-2);
        }

        .modal-footer .btn-primary::before {
            content: "\2736";
            position: absolute;
            left: -30px;
            color: var(--inner-bg);
            font-size: 24px;
        }

        .modal-footer .btn-primary::after {
            content: "\2736";
            position: absolute;
            right: -20px;
            color: var(--inner-bg);
            font-size: 24px;
        }

        @keyframes subtle-pulse {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.02);
            }

            100% {
                transform: scale(1);
            }
        }

        .modal-footer .btn-primary {
            animation: subtle-pulse 2s infinite;
        }

        .modal-footer .btn-primary:hover {
            animation: none;
        }

        .btn-close {
            background-color: var(--inner-bg);
            opacity: 1;
            padding: 12px;
            border-radius: 50%;
            box-shadow: 2px 2px 0 0 var(--shadow-color-1);
        }

        @media (max-width: 992px) {
            .modal-dialog {
                min-width: 90%;
                margin: 10px;
            }

            .modal-title {
                font-size: 36px;
            }

            .game-settings-row {
                flex-direction: column;
                text-align: center;
            }
        }
    </style>
    <link href="https://fonts.googleapis.com/css?family=Lobster|Gochi+Hand|Rock+Salt|Special+Elite" rel="stylesheet">
</head>
<body>
    <div class="container text-center">
        <h1 class="mb-4">Welcome to Mallu-Bingo</h1>

        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#settingsModal">
            Let's Play
        </button>

        <!-- Settings Modal -->
        <div class="modal fade" id="settingsModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Game Settings</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <form id="gameSettingsForm">
                        <div class="modal-body">
                            <div class="game-settings-row">
                                <div class="settings-label">Mode</div>
                                <div class="settings-control">
                                    <select id="mode" name="mode" class="form-select" required>
                                        <option value="easy">Easy</option>
                                        <option value="medium">Medium</option>
                                        <option value="hard">Hard</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="game-settings-row">
                                <div class="settings-label">Show Computer</div>
                                <div class="settings-control">
                                    <div class="form-check">
                                        <input type="checkbox" class="form-check-input" id="showComputer" name="show_computer">
                                    </div>
                                </div>
                            </div>

                            <h5 class="text-center mt-4">Choose or Create a Board:</h5>
                            <div id="bingoBoardContainer" class="bingo-board">
                                {% for row in board %}
                                    {% for cell in row %}
                                        <div class="bingo-cell">{{ cell }}</div>
                                    {% endfor %}
                                {% endfor %}
                            </div>

                            <div class="alert alert-danger" role="alert" id="boardError">
                                Please enter unique numbers from 1 to 25 in the custom board!
                            </div>

                            <div class="text-center">
                                <button type="button" id="changeBoardBtn" class="btn btn-secondary me-2 mb-2">Random</button>
                                <button type="button" id="customBoardBtn" class="btn btn-secondary mb-2">Custom</button>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="submit" class="btn btn-primary w-100">Let's Bingo!</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let currentBoard = [
            {% for row in board %}
                {{ row }},
            {% endfor %}
        ];

        document.getElementById('mode').addEventListener('change', function() {
            const showComputerCheckbox = document.getElementById('showComputer');
            if (this.value === 'hard') {
                showComputerCheckbox.checked = false;
                showComputerCheckbox.disabled = true;
            } else {
                showComputerCheckbox.disabled = false;
            }
        });

        // Change Board Functionality
        document.getElementById('changeBoardBtn').addEventListener('click', function() {
            fetch('/generate_board')
                .then(response => response.json())
                .then(board => {
                    currentBoard = board;
                    const boardContainer = document.getElementById('bingoBoardContainer');
                    boardContainer.innerHTML = '';

                    board.forEach(row => {
                        row.forEach(number => {
                            const cell = document.createElement('div');
                            cell.className = 'bingo-cell';
                            cell.textContent = number;
                            boardContainer.appendChild(cell);
                        });
                    });
                })
                .catch(error => {
                    console.error('Error generating new board:', error);
                });
        });

        // Create Custom Board
        document.getElementById('customBoardBtn').addEventListener('click', function() {
            const customBoardContainer = document.getElementById('bingoBoardContainer');
            customBoardContainer.innerHTML = '';

            for (let i = 0; i < 5; i++) {
                for (let j = 0; j < 5; j++) {
                    const input = document.createElement('input');
                    input.type = 'number';
                    input.min = 1;
                    input.max = 25;
                    input.className = 'bingo-cell';
                    input.placeholder = ` `;
                    customBoardContainer.appendChild(input);
                }
            }
        });

        // Validate Custom Board Numbers
        function validateCustomBoard() {
            const inputs = document.querySelectorAll('#bingoBoardContainer input');
            const numbers = Array.from(inputs).map(input => parseInt(input.value, 10));

            const uniqueNumbers = new Set(numbers);
            if (uniqueNumbers.size !== 25 || numbers.some(num => num < 1 || num > 25)) {
                document.getElementById('boardError').style.display = 'block';
                return false;
            }

            document.getElementById('boardError').style.display = 'none';
            return true;
        }

        document.getElementById('gameSettingsForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const data = {
                mode: formData.get('mode'),
                show_computer: formData.get('show_computer') === 'on',
                board: currentBoard
            };

            if (document.querySelector('#bingoBoardContainer input')) {
                if (!validateCustomBoard()) {
                    return;
                }

                const customBoard = Array.from(document.querySelectorAll('#bingoBoardContainer input')).map(input => parseInt(input.value, 10));
                data.board = [];
                for (let i = 0; i < 5; i++) {
                    data.board.push(customBoard.slice(i * 5, (i + 1) * 5));
                }
            }

            fetch('/submit_settings', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(result => {
                console.log(result);
                if (result.status === 'success') {
                    window.location.href = '/play';
                } else {
                    console.error('Failed to submit settings:', result);
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
        });
    </script>
</body>
</html>